# AUTOGENERATED! DO NOT EDIT! File to edit: nbs/00_tests/visualization/tst.experiment_visualization.ipynb (unless otherwise specified).

__all__ = ['generate_data_plot', 'test_plot_history', 'test_plot_metric_relationship', 'test_visualize_experiments']

# Cell
import pytest
import pandas as pd
import os
import joblib
from IPython.display import display
from dsblocks.utils.nbdev_utils import md

from hpsearch.visualization.experiment_visualization import *
from hpsearch.examples.dummy_experiment_manager import generate_data
from hpsearch.examples.dummy_experiment_manager import run_multiple_experiments

# Comes from experiment_visualization.ipynb, cell
def generate_data_plot (folder):
    em = generate_data (folder)
    run_multiple_experiments (em=em, nruns=5, noise=0.1, rate=0.1, verbose=False)

    return em

# Comes from experiment_visualization.ipynb, cell
def test_plot_history ():
    em = generate_data_plot ('plot_history')

    md ('Plot all the metrics that have been stored in model_history')
    plot_multiple_histories ([8,16], run_number=0, op='max', backend='matplotlib')

    md ('Plot only one metric, and three experiments')
    md ('We plot the test_accuracy metric')
    plot_multiple_histories ([8,12, 16], run_number=0, op='max', metrics = 'test_accuracy', backend='matplotlib')

    md ('Use plotly as backend')
    plot_multiple_histories ([8,12, 16], run_number=0, op='max', metrics = 'test_accuracy', backend='plotly')

    em.remove_previous_experiments()

# Comes from experiment_visualization.ipynb, cell
def test_plot_metric_relationship ():
    em = generate_data_plot ('plot_metric_relationship')

    md ('plot relationship between validation and accuracy metrics')
    plot_metric_relationship ('validation_accuracy', 'test_accuracy', backend='plotly')

    md ('Highlight selected experiments')
    plot_metric_relationship ('validation_accuracy', 'test_accuracy', experiment_subset=[5,2], backend='plotly')

    em.remove_previous_experiments()

# Comes from experiment_visualization.ipynb, cell
def test_visualize_experiments ():
    em = generate_data_plot ('visualize_experiments')

    visualize_experiments (visualization=['history', 'metric_correlation', 'custom'], experiments=[8,12, 16],
                       run_number=0, op='max', metrics = 'test_accuracy', backend='plotly',
                       metric_1='test_accuracy', metric_2='validation_accuracy')


    em.remove_previous_experiments()